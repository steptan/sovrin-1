<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>Sovrin DID Method Specification</title>
      <style>
        #instructions {
          border: dashed 1px black;
          padding: 1em;
          background-color:#d0d0d0;
        }
        .replace-me {
          font-style:italic;
          color:magenta
        }
      </style>
    <script
     src='https://www.w3.org/Tools/respec/respec-w3c-common'
     class='remove'></script>
    <script class='remove'>
      var respecConfig = {
        specStatus: "ED",
        editors: [{
            name: "Michael Lodder",
            url: "https://evernym.com",
          }
        ],
        processVersion: 2017,
        edDraftURI: "https://github.com/mikelodder7/sovrin",
        shortName: "sovrin"
      };
    </script>
  </head>
  <body>
    <section class="introductory">
        <h2>About</h2>
        <p>The Sovrin DID method specification conforms to the requirements specified in the DID specification
           currently published by the W3C Credentials Community Group. For more information about DIDs and
           DID method specifications, please see the <a
                    href="https://github.com/WebOfTrustInfo/rebooting-the-web-of-trust-fall2017/blob/master/topics-and-advance-readings/did-primer.md"
                    target="_blank">DID Primer.</a></p>
    </section>
    <section id='abstract'>
      <p>
        The Sovrin Ledger is a permissioned public ledger designed for privacy
        preserving self-sovereign identity. The Sovrin Ledger is governed by the
        international non-profit <a href="https://www.sovrin.org" target="_blank">Sovrin Foundation</a>.
        As the only public ledger designed exclusively for self-sovereign identity,
        Sovrin is optimized for DIDs and DID Documents. DIDs are created, stored,
        and used with verifiable claims. This specification covers how these DIDs are
        managed, the Sovrin DID methods, and related features of Sovrin of
        particular interest to DID owners, guardians, and developers.
      </p>
    </section>
    <section id='sotd'>
      <p>&nbsp;
      </p>
    </section>
    <section>
        <h2>Sovrin DID Method </h2>
        <p>The namestring that shall identify this DID method is: <code>sov</code></p>
        <p>A DID that uses this method MUST begin with the following prefix: <code>did:sov</code>.
            Per the DID specification, this string MUST be in lowercase. The remainder of the DID, after the prefix,
            is the NSI specified below.</p>
    </section>
    <section>
        <h2>Target System(s)</h2>
        <p>The Sovrin Ledger uses the Hyperledger Indy code base combined with
           a trusted network of anchor nodes (Trust Anchors) that implement the
           Sovrin trust framework. The Sovrin Ledger is a global public utility
           for decentralized identity. The data records on the Sovrin Ledger contain
           information about the entity they describe e.g. Public Keys, Service
           Endpoints, Claim Schemas, Claim Definitions, and Revocation Registries.
           A Sovrin Identity is never fully defined on the Sovrin Ledger. Sovrin
           DIDs should not reveal any Private Data. Every Sovrin Identity has one
           or more DIDs. DIDs support the full spectrum of identity from
           anonymity to verinymity.

           DIDs that are authorized to be written using Zero-Knowledge Proof so
           they are blinded as to the Legal Identity of the authorizing Identity
           Owner are known as Anonyms. Anonyms can be either Single-Use a.k.a.
           Pairwise-Unique Identifiers that are used for only a single digital
           relationship, or Multi-Use Identifiers that are used for more than one
           digital relationship--better known as Pseudonyms.

           DIDs that are authorized to be written using the digital signature of
           a Trust Anchor so that they may be directly or indirectly associated
           with the Legal Identity of the Identity Owner are called Verinyms.
           Verinyms are needed for the legal accoutability of Trust Anchors.
           Verinyms on Sovrin are one of two types:
           <ul>
             <li>A Trust Anchor Verinym is the DID of a Trust Anchor itself.
                  This DID is required to have at least one Public Claim asserting
                  the Trust Anchor's Legal Identity.</li>
             <li>An Anchored Verinym is the DID for an Identity Owner for whom
                 the Trust Anchor can confirm consent to the Sovrin Identity
                 Owner Agreement.
             </li>
           </ul>
         </p>
         <p>This targets currently deployed Sovrin plenum consensus rules.</p>
    </section>
    <section>
        <h2>Namespace Specific Identifier (NSI)</h2>
        <p>
          The Sovrin DID scheme is defined by the following ABNF:<br><br>
          <code>
            sovrin-did = "did:sov:{idstring}"<br>
            idstring   = 22/23 char<br>
            char       = ALPHA / DIGIT<br>
          </code><br>
          All Sovrin DIDs are exactly 22 or 23 characters representing a <a href="https://en.bitcoin.it/wiki/Base58Check_encoding" target="_blank">base58Check encoding</a>
          of the first 16 bytes of a 256 bit Ed25519 verification key (the public
          portion of the key pair). This may or may not be an active verification
          key for the identity owner; that information is only available in the
          key descriptions in the owner section of the DID Document.
          </p>
        <h3>Namestring Generation Method</h3>
        <p>The <code>sov</code> DID method generates NSIs using <a href="https://en.bitcoin.it/wiki/Base58Check_encoding" target="_blank">base58Check encoding</a>
          of the first 16 bytes of a 256 bit Ed25519 public key.
        </p>
        <h3>ABNF Definition</h3>
        <pre>
            DIGIT = "0".."9"
            ALPHA = "A".."Z"
        </pre>
        <p>A convenient regex to match <code>sov</code> DIDs is: <br><br>
            <code>^[0-9a-z]{22,23}$</code></p>
        <h3>Examples</h3>
        <p>A valid <code>sov</code> DID might be: <code>did:sov:sm3n9jakencue7635xgqc8x9</code>.
            Valid values only include lowercase chars</p>
    </section>
    <section>
      <h2>JSON-LD Context Definition</h2>
        <p class="replace-me">If your method involves storing any state in a DID document for purposes of controlling updates to the DID document, you MUST define a JSON-LD context in this section.)</p>
        <p>The official definition of the <code>htcr</code> JSON-LD context is:</p>
      <pre class="replace-me json" style="color:magenta">
      {
           "@context":
           {
              "Person": "http://xmlns.com/foaf/0.1/Person",
              "xsd": "http://www.w3.org/2001/XMLSchema#",
              "name": "http://xmlns.com/foaf/0.1/name",
              "nickname": "http://xmlns.com/foaf/0.1/nick",
              "affiliation": "http://schema.org/affiliation",
              "depiction":
              {
                 "@id": "http://xmlns.com/foaf/0.1/depiction",
                 "@type": "@id"
              },
              "image":
              {
                 "@id": "http://xmlns.com/foaf/0.1/img",
                 "@type": "@id"
              }
          }
       }</pre>
       <p class="replace-me">With minor edits, this is published at https://example.com/mycontext.jsonld. Changes are expected as this template evolves... ]]]</p>
       <p class="replace-me">If your JSON-LD context is not versioned exactly through the document versioning mechanism of this spec, define how your JSON-LD context will be versioned.</p>
    </section>
    <section>
        <h2>CRUD Operation Definitions</h2>

        <h3>Create (Register)</h3>
        <p>The DID method specification must specify how a client creates a DID record—the combination of a DID and its associated DDO—on the target system, including all cryptographic operations necessary to establish proof of ownership.</p>
        <p>For example:</p>
        <p>To create a DID, you must submit a transaction that looks like this: <br>
          <pre>
                What Lovesh said is in current production
                {
                    "identifier": &lt;Trust Anchor DID&gt;,
                    "signature": &lt;signature over this transaction from the Trust Anchor&gt;,
                    "reqId": &lt;a nonce for this transaction&gt;,
                    "operation": {
                        "type": "NYM",
                        "dest": &lt;new DID that is being registered&gt;,
                        ["verkey": &lt;verification key of the new DID&gt;],
                        ["role": &lt; TrustAnchor, TGB, STEWARD or TRUSTEE&gt;]
                    }
                }

                New Proposal
                {
                    "identifier": &lt;Trust Anchor DID&gt;,
                    "signature": &lt;signature over this transaction from the Trust Anchor&gt;,
                    "reqId": &lt;A nonce for this transaction&gt;,
                    "operation": {
                        "type": "NYM",
                        "dest": &lt;new DID that is being registered&gt;,
                        "document": {
                            "key": {
                                "type": &lt;Ed25519, Ed41417, P-256, P-384, P-512, RSA&gt;
                                "use": &lt;verification&gt;
                                "format": &lt;base64, base58, hex, pem&gt;
                                "value": &lt;Key material encoded in format&gt;
                            },
                            "guardian": &lt;DID of the guardian&gt;, //OPTIONAL
                            "service": [ //OPTIONAL
                              &lt;A URI for the endpoint&gt;
                            ]
                        }
                    }
                }

                Example
                {
                    "identifier": "did:sov:29wksjcn38djfh47ruqrtcd5",
                    "signature": "base64:1qaz2wsx3edc4rfv5tgb6yhn7ujm8iklop0+/==",
                    "reqId": "base64:0okn987yhbgfterdscxsw",
                    "operation": {
                        "type": "NYM",
                        "dest": "did:sov:mnjkl98uipsndg2hdjdjuf7",
                        "document": {
                            "key": {
                                "type": "Ed25519",
                                "use": "verification",
                                "format": "pem"
                                "value": "-----BEGIN PUBLIC KEY...END PUBLIC KEY-----\r\n"
                            },
                            "guardian": "did:sov:1xw3ecg56ubjgfdqaz87uok9",
                            "service": [
                              "https://www.sovrin.org/agents"
                            ]
                        }
                    }
                }
            </pre> The transaction must be signed by a Trust Anchor must provide an un-registered DID and a document of data
            about that DID. Possible outcomes from the creation operation include:
            <br/> REQNACK: “Malformed transaction or missing required fields”
            <br/> REJECT: “DID already rejistered or non Trust Anchor authored the transaction or signature did not match”
            <br/> REPLY: "Contains the sequence number of the transaction and the merkle proof"
            <br/>
        </p>

        <h3>Read (Resolve)</h3>
        <p>A Sovrin DID record can be looked up directly by the DID using a standard Sovrin GET_NYM transaction that simply
            takes the DID and will return the DID record. The client trusts the DID record because it either receives the
            same DID record from sufficient number of validators or it receives a proof of the DID record from a single validator
            that the DID record is part of a merkle tree whose root has an aggregate signature from sufficient number of
            validators.
        </p>
        <p>This is how the DID record query looks like</p>
        <pre>
                {
                    "identifier": &lt;DID of the author of this query&gt;,
                    "signature": &lt;signature over this transaction from the author&gt;,
                    "reqId": &lt;a nonce for this query&gt;,
                    "operation": {
                        "type": "GET_NYM",
                        "dest": &lt;DID whose record needs to be queried&gt;
                    }
                }
        </pre>
        <p>Anyone can query a DID record, by sending the above request. The response contains the details of DID, it's role
            and verification key.
        </p>
        <pre>
                What Lovesh said is in current production
                {
                    "identifier": &lt;DID of the author of this query&gt;,
                    "signature": &lt;signature over this transaction from the author&gt;,
                    "reqId": &lt;a nonce for this query&gt;,
                    "type": "GET_NYM",
                    "dest": &lt;DID whose record needs to be queried&gt;,
                    "verkey": &lt; verification key of the DID &gt;,
                    "role": &lt; role, whether this DID is a Trust Anchor, a Steward, Trustee or is a non-priviledged identity &gt;,
                }

                New Proposal
                {
                    "identifier": &lt;DID of the author of this query&gt;,
                    "signature": &lt;signature over this transaction from the author&gt;,
                    "reqId": &lt;a nonce for this query&gt;,
                    "type": "GET_NYM",
                    "dest": &lt;DID whose record needs to be queried&gt;,
                    "key": {
                        "type": &lt;Ed25519, Ed41417, P-256, P-384, P-512, RSA&gt;
                        "use": &lt;verification&gt;
                        "format": &lt;base64, base58, hex, pem&gt;
                        "value": &lt;Key material encoded in format&gt;
                    }
                }
        </pre>

        <h3>Update (Replace)</h3>
        <p>To replace the DID document, the owner or guardian (guardianship ends once ownership begins) of the DID should send the following
            transaction with a
            <pre>
                  What Lovesh said is in current production
                  {
                      "identifier": &lt;DID of the owner or the guardian&gt;,
                      "signature": &lt;signature over this transaction from the DID in identifier&gt;,
                      "reqId": &lt;a nonce for this transaction&gt;,
                      "operation": {
                          "type": "NYM",
                          "dest": &lt;DID whose record is being updated&gt;,
                          [verkey: &lt;new verification key of the DID&gt;],
                      }
                  }

                  New Proposal
                  {
                    "identifier": &lt;DID of the author of this query&gt;,
                    "signature": [&lt;signature over this transaction from the author&gt;,]
                    "reqId": &lt;a nonce for this query&gt;,
                    "operation": {
                        "type": "NYM",
                        "dest": &lt;DID whose record needs to be queried&gt;,
                        "document": {
                            "key": {
                                "type": &lt;Ed25519, Ed41417, P-256, P-384, P-512, RSA&gt;
                                "use": &lt;verification&gt;
                                "format": &lt;base64, base58, hex, pem&gt;
                                "value": &lt;Key material encoded in format&gt;
                            },
                            "guardian": &lt;DID of the guardian&gt;, //OPTIONAL
                            "service": [ //OPTIONAL
                              &lt;A URI for the endpoint&gt;
                            ]
                        }
                      }
                  }
                </pre>
        </p>

        <h3>Delete (Revoke)</h3>
        <p>The method spec MUST define how a DID can revoke it's verification key.  Although a core feature of distributed ledgers is immutability, a DID method must specify
            how a client can revoke a DID record on the target system, including all cryptographic operations necessary to
            establish proof of revocation. Revocation is the one way final operation for a DID.
        </p>
        <p> NOTE: Revocation is non-reversible--do not confuse it with key rotation.
            No use after revocation is an equivalent problem to the double-spend problem,
            which is what motivates the use of blockchains and other distributed
            ledger technologies. To revoke the document of the DID, the owner of
            the DID should send the following transaction.
            <pre>
                {
                    "identifier": &lt;DID of the owner&gt;,
                    "signature": &lt;signature over this transaction from the DID in identifier&gt;,
                    "reqId": &lt;a nonce for this transaction&gt;,
                    "operation": {
                        "type": "NYM",
                        "dest": &lt;DID whose key is being revoked&gt;,
                        "document": null
                    }
                }
            </pre>
        </p>
    </section>

    <section>
        <h2>Security Considerations</h2>
        <div class="replace-me">
        <h3>Attacks</h3>
            <p>At least the following forms of attack MUST be considered: eavesdropping, replay, message insertion, deletion, modification, impersonation, and man-in-the-middle. Potential denial of service attacks MUST be identified as well. If the protocol incorporates cryptographic protection mechanisms, it should be clearly indicated which portions of the data are protected and what the protections are (i.e., integrity only, confidentiality, and/or endpoint authentication, etc.). Some indication should also be given to what sorts of attacks the cryptographic protection is susceptible. Data which should be held secret (keying material, random seeds, etc.) should be clearly labeled. If the technology involves authentication, particularly user-host authentication, the security of the authentication method MUST be clearly specified.</p>

        <h3>Residual Risks</h3>
            <p>Discuss risks such as from compromise in a related protocol, incorrect implementation, or cipher) after threat mitigation has been deployed.

            <h3>Recovery From Key Compromise</h3>

            <p>This section MUST provide integrity protection and update authentication for all operations required by Section 7 of this specification (DID Operations).</p>

            <p><a href="https://en.wikipedia.org/wiki/Confused_deputy_problem" target="_blank">Confused Deputy Problem</a> when attempting separation of writeAuthorization from authenticationCredential.</p>
            <p>Other sections from DID spec to incorporate into the outline:</p>

            <pre style="color:magenta">
            9.3 Authentication Service Endpoints
            9.4 Non-Repudiation
            9.5 Notification of DDO Changes
            9.6 Key and Signature Expiration
            9.7 Key Revocation and Recovery *
            </pre>
        </div>
    </section>

    <section>
        <h2>Privacy Considerations</h2>
        <div class="replace-me">
            <p>Considering <a href="http://www.lifewithalacrity.com/2015/04/the-four-kinds-of-privacy.html" target="_blank">all
                four types of privacy</a>, explore issues from these sections of the DID spec:</p>

            <pre style="color:magenta">
            10. Privacy Considerations
            10.1 Requirements of DID Method Specifications
            10.2 Keep Personally-Identifiable Information (PII) Off-Ledger
            10.3 DID Correlation Risks and Pseudonymous DIDs
            10.4 DDO Correlation Risks
            10.5 Herd Privacy
            </pre>
        </div>
    </section>

    <section>
        <h2>Reference Implementations</h2>
        <p class="replace-me">The code at https://github.com/myaccount/myrepo is intended to be the preferred embodiment of this DID method. Commit hash 4fc87fc5e85b2a071abfa7d8dfb15c06cd266dd5 is the version that officially aligns with this version of the spec.</p>
        <p class="replace-me">Note that the code includes a test suite (see tests/compliance_suite); any other implementations should ensure that all tests pass before they claim compatibility.</p>
    </section>

    <section>
        <h2>Resources</h2>
        <p class="replace-me">Many developers maintaining the code and spec tend to hang out in RocketChat at chat.myorg.org, #btcrimpl. You might also connect with us in W3C working groups or at the semi-annual Rebooting Web of Trust conferences</p>
    </section>

  </body>
</html>
